import { cloneDeep } from 'lodash';
import { pickFromArray } from '../../functions/randomUtils';
import CharacterSheet, { SubStep } from '../../interfaces/CharacterSheet';
import { Spell, spellsCircles } from '../../interfaces/Spells';
import { Atributo } from '../atributos';

export const manaExpenseByCircle: Record<spellsCircles, number> = {
  [spellsCircles.c1]: 1,
  [spellsCircles.c2]: 3,
  [spellsCircles.c3]: 6,
  [spellsCircles.c4]: 10,
  [spellsCircles.c5]: 15,
};

export enum spellsCircle1Names {
  abencoarAlimentos = 'abencoarAlimentos',
  acalmarAnimal = 'acalmarAnimal',
  armaduraArcana = 'armaduraArcana',
  adagaMental = 'adagaMental',
  alarme = 'alarme',
  amedrontar = 'amedrontar',
  areaEscorregadia = 'areaEscorregadia',
  armaEspiritual = 'armaEspiritual',
  armaMagica = 'armaMagica',
  armamentoDaNatureza = 'armamentoDaNatureza',
  aviso = 'aviso',
  bencao = 'bencao',
  caminhosDaNatureza = 'caminhosDaNatureza',
  comando = 'comando',
  compreensao = 'compreensao',
  concentracaoDeCombate = 'concentracaoDeCombate',
  conjurarMonstro = 'conjurarMonstro',
  consagrar = 'consagrar',
  controlarPlantas = 'controlarPlantas',
  criarElementos = 'criarElementos',
  criarIlusao = 'criarIlusao',
  curarFerimentos = 'curarFerimentos',
  despedacar = 'despedacar',
  detectarAmeacas = 'detectarAmeacas',
  disfarceIlusorio = 'disfarceIlusorio',
  enfeiticar = 'enfeiticar',
  escudoDaFe = 'escudoDaFe',
  escuridao = 'escuridao',
  explosaoDeChamas = 'explosaoDeChamas',
  hipnotismo = 'hipnotismo',
  imagemEspelhada = 'imagemEspelhada',
  infligirFerimentos = 'infligirFerimentos',
  lequeCromatico = 'lequeCromatico',
  luz = 'luz',
  nevoa = 'nevoa',
  orientacao = 'orientacao',
  perdicao = 'perdicao',
  primorAtletico = 'primorAtletico',
  profanar = 'profanar',
  protecaoDivina = 'protecaoDivina',
  quedaSuave = 'quedaSuave',
  raioDoEnfraquecimento = 'raioDoEnfraquecimento',
  resistenciaAEnergia = 'resistenciaAEnergia',
  santuario = 'santuario',
  setaInfalivelDeTalude = 'setaInfalivelDeTalude',
  sono = 'sono',
  suporteAmbiental = 'suporteAmbiental',
  teia = 'teia',
  toqueChocante = 'toqueChocante',
  trancaArcana = 'trancaArcana',
  tranquilidade = 'tranquilidade',
  transmutarObjetos = 'transmutarObjetos',
  visaoMistica = 'visaoMistica',
  vitalidadeFantasma = 'vitalidadeFantasma',
}

export enum spellsCircle2Names {
  campoDeForca = 'campoDeForca',
  dissiparMagia = 'dissiparMagia',
  refugio = 'refugio',
  runaDeProtecao = 'runaDeProtecao',
  ligacaoTelepatica = 'ligacaoTelepatica',
  localizacao = 'localizacao',
  mapear = 'mapear',
  amarrasEtereas = 'amarrasEtereas',
  montariaArcana = 'montariaArcana',
  saltoDimensional = 'saltoDimensional',
  servosInvisiveis = 'servosInvisiveis',
  desesperoEsmagador = 'desesperoEsmagador',
  marcaDaObediencia = 'marcaDaObediencia',
  bolaDeFogo = 'bolaDeFogo',
  flechaAcida = 'flechaAcida',
  relampago = 'relampago',
  soproDasUivantes = 'soproDasUivantes',
  aparenciaPerfeita = 'aparenciaPerfeita',
  camuflagemIlusoria = 'camuflagemIlusoria',
  esculpirSons = 'esculpirSons',
  invisibilidade = 'invisibilidade',
  conjurarMortosVivos = 'conjurarMortosVivos',
  cranioVoadorDeVladislav = 'cranioVoadorDeVladislav',
  toqueVampirico = 'toqueVampirico',
  alterarTamanho = 'alterarTamanho',
  metamorfose = 'metamorfose',
  velocidade = 'velocidade',
  sussurosInsanos = 'sussurosInsanos',
  augurio = 'augurio',
  circuloDaJustica = 'circuloDaJustica',
  vestimentaDaFe = 'vestimentaDaFe',
  condicao = 'condicao',
  globoDaVerdadeDeGwen = 'globoDaVerdadeDeGwen',
  menteDivina = 'menteDivina',
  vozDivina = 'vozDivina',
  socoDeArsenal = 'socoDeArsenal',
  aliadoAnimal = 'aliadoAnimal',
  oracao = 'oracao',
  controlarFogo = 'controlarFogo',
  purificacao = 'purificacao',
  raioSolar = 'raioSolar',
  tempestadaDivina = 'tempestadaDivina',
  silencio = 'silencio',
  miasmaMefitico = 'miasmaMefitico',
  rogarMaldicao = 'rogarMaldicao',
  controlarMadeira = 'controlarMadeira',
  fisicoDivino = 'fisicoDivino',
  enxameDePestes = 'exameDePestes',
}

export const spellsCircle1: Record<spellsCircle1Names, Spell> = {
  [spellsCircle1Names.abencoarAlimentos]: {
    spellCircle: spellsCircles.c1,
    nome: 'Abençoar Alimentos',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: 'Alimento para 1 criatura',
    duracao: 'Cena',
    school: 'Trans',
  },
  [spellsCircle1Names.acalmarAnimal]: {
    spellCircle: spellsCircles.c1,
    nome: 'Acalmar Animal',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: '1 animal',
    duracao: 'Cena',
    resistencia: 'Vontade anula',
    school: 'Encan',
  },
  [spellsCircle1Names.adagaMental]: {
    spellCircle: spellsCircles.c1,
    nome: 'Adaga Mental',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: '1 criatura',
    duracao: 'Instantânea',
    resistencia: 'Vontade parcial',
    school: 'Encan',
  },
  [spellsCircle1Names.alarme]: {
    spellCircle: spellsCircles.c1,
    nome: 'Alarme',
    execucao: 'Padrão',
    alcance: 'Curto',
    area: 'Esfera de 9m de raio',
    duracao: '1 dia',
    school: 'Abjur',
  },
  [spellsCircle1Names.amedrontar]: {
    spellCircle: spellsCircles.c1,
    nome: 'Amedrontar',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: '1 animal ou humanoide de ND 2 ou menor',
    duracao: 'Cena',
    resistencia: 'Vontade parcial',
    school: 'Necro',
  },
  [spellsCircle1Names.areaEscorregadia]: {
    spellCircle: spellsCircles.c1,
    nome: 'Área Escorregadia',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: 'Quadrado de 3m ou 1 objeto',
    duracao: 'Cena',
    resistencia: 'Reflexos',
    school: 'Conv',
  },
  [spellsCircle1Names.armaEspiritual]: {
    spellCircle: spellsCircles.c1,
    nome: 'Arma Espiritual',
    execucao: 'Padrão',
    alcance: 'Pessoal',
    alvo: 'Você',
    duracao: 'Cena',
    school: 'Conv',
  },
  [spellsCircle1Names.armaMagica]: {
    spellCircle: spellsCircles.c1,
    nome: 'Arma Mágica',
    execucao: 'Padrão',
    alcance: 'Toque',
    alvo: '1 arma',
    duracao: 'Cena',
    school: 'Trans',
  },
  [spellsCircle1Names.armaduraArcana]: {
    spellCircle: spellsCircles.c1,
    nome: 'Armadura Arcana',
    execucao: 'Padrão',
    alcance: 'Pessoal',
    alvo: 'Você',
    duracao: 'Cena',
    school: 'Abjur',
  },
  [spellsCircle1Names.armamentoDaNatureza]: {
    spellCircle: spellsCircles.c1,
    nome: 'Armamento da Natureza',
    execucao: 'Padrão',
    alcance: 'Toque',
    alvo: '1 arma',
    duracao: 'Cena',
    school: 'Trans',
  },
  [spellsCircle1Names.aviso]: {
    spellCircle: spellsCircles.c1,
    nome: 'Aviso',
    execucao: 'Movimento',
    alcance: 'Longo',
    alvo: '1 criatura',
    duracao: 'Instantânea',
    school: 'Adiv',
  },
  [spellsCircle1Names.bencao]: {
    spellCircle: spellsCircles.c1,
    nome: 'Bênção',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: 'Criaturas escolhidas',
    duracao: 'Cena',
    school: 'Encan',
  },
  [spellsCircle1Names.caminhosDaNatureza]: {
    spellCircle: spellsCircles.c1,
    nome: 'Caminhos da Natureza',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: '1 arma',
    duracao: 'Cena',
    school: 'Conv',
  },
  [spellsCircle1Names.comando]: {
    spellCircle: spellsCircles.c1,
    nome: 'Comando',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: '1 humanoide',
    duracao: '1 rodada',
    resistencia: 'Vontade anula',
    school: 'Encan',
  },
  [spellsCircle1Names.compreensao]: {
    spellCircle: spellsCircles.c1,
    nome: 'Compreensão',
    execucao: 'Padrão',
    alcance: 'Toque',
    alvo: '1 criatura ou texto',
    duracao: 'Cena',
    resistencia: 'Vontade anula',
    school: 'Adiv',
  },
  [spellsCircle1Names.concentracaoDeCombate]: {
    spellCircle: spellsCircles.c1,
    nome: 'Concentração de Combate',
    execucao: 'Livre',
    alcance: 'Pessoal',
    alvo: 'Você',
    duracao: '1 rodada',
    school: 'Adiv',
  },
  [spellsCircle1Names.conjurarMonstro]: {
    spellCircle: spellsCircles.c1,
    nome: 'Conjurar Monstro',
    execucao: 'Completa',
    alcance: 'Curto',
    alvo: '1 criatura conjurada',
    duracao: 'Sustentada',
    school: 'Conv',
  },
  [spellsCircle1Names.consagrar]: {
    spellCircle: spellsCircles.c1,
    nome: 'Consagrar',
    execucao: 'Padrão',
    alcance: 'Longo',
    area: 'Esfera com 9m de raio',
    duracao: '1 dia',
    school: 'Evoc',
  },
  [spellsCircle1Names.controlarPlantas]: {
    spellCircle: spellsCircles.c1,
    nome: 'Controlar Plantas',
    execucao: 'Padrão',
    alcance: 'Curto',
    area: 'quadrado com 9m de lado',
    duracao: 'Cena',
    resistencia: 'Reflexos anula',
    school: 'Trans',
  },
  [spellsCircle1Names.criarElementos]: {
    spellCircle: spellsCircles.c1,
    nome: 'Criar Elementos',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: 'Elemento escolhido',
    duracao: 'Instantânea',
    school: 'Conv',
  },
  [spellsCircle1Names.criarIlusao]: {
    spellCircle: spellsCircles.c1,
    nome: 'Criar Ilusão',
    execucao: 'Padrão',
    alcance: 'Médio',
    alvo: 'Ilusão que se estende a até 4 cubos de 1,5m',
    duracao: 'Cena',
    resistencia: 'Vontade desacredita',
    school: 'Ilusão',
  },
  [spellsCircle1Names.curarFerimentos]: {
    spellCircle: spellsCircles.c1,
    nome: 'Curar Ferimentos',
    execucao: 'Padrão',
    alcance: 'Toque',
    alvo: '1 criatura',
    duracao: 'Instantânea',
    school: 'Evoc',
  },
  [spellsCircle1Names.despedacar]: {
    spellCircle: spellsCircles.c1,
    nome: 'Despedaçar',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: '1 critura ou objeto mundano pequeno',
    duracao: 'Instantânea',
    resistencia: 'Fortitude parcial ou Reflexos anula',
    school: 'Evoc',
  },
  [spellsCircle1Names.detectarAmeacas]: {
    spellCircle: spellsCircles.c1,
    nome: 'Detectar Ameaças',
    execucao: 'Padrão',
    alcance: 'Pessoal',
    alvo: 'Esfera de 9m de raio',
    duracao: 'Instantânea',
    school: 'Adiv',
  },
  [spellsCircle1Names.disfarceIlusorio]: {
    spellCircle: spellsCircles.c1,
    nome: 'Disfarce Ilusório',
    execucao: 'Padrão',
    alcance: 'Pessoal',
    alvo: 'Você',
    duracao: 'Cena',
    resistencia: 'Vontade desacredita',
    school: 'Ilusão',
  },
  [spellsCircle1Names.enfeiticar]: {
    spellCircle: spellsCircles.c1,
    nome: 'Enfeitiçar',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: '1 humanoide',
    duracao: 'Cena',
    resistencia: 'Vontade anula',
    school: 'Encan',
  },
  [spellsCircle1Names.escudoDaFe]: {
    spellCircle: spellsCircles.c1,
    nome: 'Escudo da Fé',
    execucao: 'Reação',
    alcance: 'Curto',
    alvo: '1 criatura',
    duracao: '1 turno',
    school: 'Abjur',
  },
  [spellsCircle1Names.escuridao]: {
    spellCircle: spellsCircles.c1,
    nome: 'Escuridão',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: '1 objeto',
    duracao: 'Cena',
    resistencia: 'Vontade anula',
    school: 'Necro',
  },
  [spellsCircle1Names.explosaoDeChamas]: {
    spellCircle: spellsCircles.c1,
    nome: 'Explosão de Chamas',
    execucao: 'Padrão',
    alcance: '6m',
    area: 'Cone',
    duracao: 'Instantânea',
    school: 'Evoc',
  },
  [spellsCircle1Names.hipnotismo]: {
    spellCircle: spellsCircles.c1,
    nome: 'Hipnotismo',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: 'Criaturas escolhidas de ND 2 ou menor',
    duracao: '1d4 rodadas',
    resistencia: 'Vontade anula',
    school: 'Encan',
  },
  [spellsCircle1Names.imagemEspelhada]: {
    spellCircle: spellsCircles.c1,
    nome: 'Imagem Espelhada',
    execucao: 'Padrão',
    alcance: 'Pessoal',
    alvo: 'Você',
    duracao: 'Cena',
    school: 'Ilusão',
  },
  [spellsCircle1Names.infligirFerimentos]: {
    spellCircle: spellsCircles.c1,
    nome: 'Infligir Ferimentos',
    execucao: 'Padrão',
    alcance: 'Toque',
    alvo: '1 criatura',
    duracao: 'Instantânea',
    resistencia: 'Fortitude reduz à metade',
    school: 'Necro',
  },
  [spellsCircle1Names.lequeCromatico]: {
    spellCircle: spellsCircles.c1,
    nome: 'Leque Cromático',
    execucao: 'Padrão',
    alcance: '4,5m',
    area: 'Cone',
    duracao: 'Instantânea',
    resistencia: 'Vontade anula',
    school: 'Ilusão',
  },
  [spellsCircle1Names.luz]: {
    spellCircle: spellsCircles.c1,
    nome: 'Luz',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: '1 objeto',
    duracao: 'Cena',
    resistencia: 'Vontade anula',
    school: 'Evoc',
  },
  [spellsCircle1Names.nevoa]: {
    spellCircle: spellsCircles.c1,
    nome: 'Névoa',
    execucao: 'Padrão',
    alcance: 'Curto',
    area: 'Nuvem com 6m de raio e altura',
    duracao: 'Cena',
    school: 'Conv',
  },
  [spellsCircle1Names.orientacao]: {
    spellCircle: spellsCircles.c1,
    nome: 'Orientação',
    execucao: 'Movimentação',
    alcance: 'Curto',
    alvo: '1 criatura',
    duracao: 'Cena',
    school: 'Adiv',
  },
  [spellsCircle1Names.perdicao]: {
    spellCircle: spellsCircles.c1,
    nome: 'Perdição',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: 'Criaturas escolhidas',
    duracao: 'Cena',
    resistencia: 'Nenhuma',
    school: 'Necro',
  },
  [spellsCircle1Names.primorAtletico]: {
    spellCircle: spellsCircles.c1,
    nome: 'Primor Atlético',
    execucao: 'Padrão',
    alcance: 'Toque',
    alvo: '1 criatura',
    duracao: 'Cena',
    school: 'Trans',
  },
  [spellsCircle1Names.profanar]: {
    spellCircle: spellsCircles.c1,
    nome: 'Profanar',
    execucao: 'Padrão',
    alcance: 'Longo',
    area: 'Esfera com 9m de raio',
    duracao: '1 dia',
    school: 'Necro',
  },
  [spellsCircle1Names.protecaoDivina]: {
    spellCircle: spellsCircles.c1,
    nome: 'Proteção Divina',
    execucao: 'Padrão',
    alcance: 'Toque',
    alvo: '1 criatura',
    duracao: 'Cena',
    school: 'Abjur',
  },
  [spellsCircle1Names.quedaSuave]: {
    spellCircle: spellsCircles.c1,
    nome: 'Queda Suave',
    execucao: 'Reação',
    alcance: 'Curto',
    alvo: '1 criatura ou objeto com até 200kg',
    duracao: 'Até chegar ao solo ou cena, o que vier primeiro',
    school: 'Trans',
  },
  [spellsCircle1Names.raioDoEnfraquecimento]: {
    spellCircle: spellsCircles.c1,
    nome: 'Raio do Enfraquecimento',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: '1 criatura',
    duracao: 'Cena',
    resistencia: 'Fortitude parcial',
    school: 'Necro',
  },
  [spellsCircle1Names.resistenciaAEnergia]: {
    spellCircle: spellsCircles.c1,
    nome: 'Resistência a Energia',
    execucao: 'Padrão',
    alcance: 'Toque',
    alvo: '1 criatura',
    duracao: 'Cena',
    school: 'Abjur',
  },
  [spellsCircle1Names.santuario]: {
    spellCircle: spellsCircles.c1,
    nome: 'Santuário',
    execucao: 'Padrão',
    alcance: 'Toque',
    alvo: '1 criatura',
    duracao: 'Cena',
    resistencia: 'Vontade anula',
    school: 'Abjur',
  },
  [spellsCircle1Names.setaInfalivelDeTalude]: {
    spellCircle: spellsCircles.c1,
    nome: 'Seta Infalível de Talude',
    execucao: 'Padrão',
    alcance: 'Médio',
    alvo: 'Até 2 criaturas',
    duracao: 'Instantânea',
    school: 'Evoc',
  },
  [spellsCircle1Names.sono]: {
    spellCircle: spellsCircles.c1,
    nome: 'Sono',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: '1 criatura de ND 2 ou menor',
    duracao: 'Cena',
    resistencia: 'Vontade parcial',
    school: 'Encan',
  },
  [spellsCircle1Names.suporteAmbiental]: {
    spellCircle: spellsCircles.c1,
    nome: 'Suporte Ambiental',
    execucao: 'Padrão',
    alcance: 'Toque',
    alvo: '1 criatura',
    duracao: '1 dia',
    school: 'Abjur',
  },
  [spellsCircle1Names.teia]: {
    spellCircle: spellsCircles.c1,
    nome: 'Teia',
    execucao: 'Padrão',
    alcance: 'Curto',
    area: 'Cubo com 6m de lado',
    duracao: 'Cena',
    resistencia: 'Reflexos anula',
    school: 'Conv',
  },
  [spellsCircle1Names.toqueChocante]: {
    spellCircle: spellsCircles.c1,
    nome: 'Toque Chocante',
    execucao: 'Padrão',
    alcance: 'Toque',
    alvo: '1 criatura',
    duracao: 'Instantânea',
    resistencia: 'Fortitude reduz à metade',
    school: 'Evoc',
  },
  [spellsCircle1Names.trancaArcana]: {
    spellCircle: spellsCircles.c1,
    nome: 'Tranca Arcana',
    execucao: 'Padrão',
    alcance: 'Toque',
    alvo: '1 objeto Grande ou menor',
    duracao: 'Permanente',
    school: 'Abjur',
  },
  [spellsCircle1Names.tranquilidade]: {
    spellCircle: spellsCircles.c1,
    nome: 'Tranquilidade',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: '1 animal ou humanoide',
    duracao: 'Cena',
    resistencia: 'Vontade parcial',
    school: 'Encan',
  },
  [spellsCircle1Names.transmutarObjetos]: {
    spellCircle: spellsCircles.c1,
    nome: 'Transmutar Objetos',
    execucao: 'Padrão',
    alcance: 'Toque',
    alvo: 'Matéria-prima, como madeeira, rochas, ossos',
    duracao: 'Cena',
    school: 'Trans',
  },
  [spellsCircle1Names.visaoMistica]: {
    spellCircle: spellsCircles.c1,
    nome: 'Visão Mística',
    execucao: 'Padrão',
    alcance: 'Toque',
    alvo: 'Você',
    duracao: 'Cena',
    school: 'Adiv',
  },
  [spellsCircle1Names.vitalidadeFantasma]: {
    spellCircle: spellsCircles.c1,
    nome: 'Vitalidade Fantasma',
    execucao: 'Padrão',
    alcance: 'Pessoal',
    alvo: 'Você',
    duracao: 'Instantânea',
    school: 'Necro',
  },
};

export const spellsCircle2: Record<spellsCircle2Names, Spell> = {
  [spellsCircle2Names.augurio]: {
    spellCircle: spellsCircles.c2,
    nome: 'Augúrio',
    execucao: 'Completa',
    alcance: 'Pessoal',
    alvo: 'Você',
    duracao: 'Instatânea',
    school: 'Adiv',
  },
  [spellsCircle2Names.sussurosInsanos]: {
    spellCircle: spellsCircles.c2,
    nome: 'Sussuros Insanos',
    execucao: 'Padrão',
    alcance: 'Curto',
    alvo: '1 humanoide',
    duracao: 'Cena',
    resistencia: 'Vontade anula',
    school: 'Encan',
  },
  [spellsCircle2Names.campoDeForca]: {
    spellCircle: spellsCircles.c2,
    nome: 'Campo de Força',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Abjur',
  },
  [spellsCircle2Names.dissiparMagia]: {
    spellCircle: spellsCircles.c2,
    nome: 'Dissipar Magia',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Abjur',
  },
  [spellsCircle2Names.refugio]: {
    spellCircle: spellsCircles.c2,
    nome: 'Refúgio',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Abjur',
  },
  [spellsCircle2Names.runaDeProtecao]: {
    spellCircle: spellsCircles.c2,
    nome: 'Runa de Proteção',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Abjur',
  },
  [spellsCircle2Names.ligacaoTelepatica]: {
    spellCircle: spellsCircles.c2,
    nome: 'Ligação Telepática',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Adiv',
  },
  [spellsCircle2Names.localizacao]: {
    spellCircle: spellsCircles.c2,
    nome: 'Localização',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Adiv',
  },
  [spellsCircle2Names.mapear]: {
    spellCircle: spellsCircles.c2,
    nome: 'Mapear',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Adiv',
  },
  [spellsCircle2Names.amarrasEtereas]: {
    spellCircle: spellsCircles.c2,
    nome: 'Amarras Etéreas',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Conv',
  },
  [spellsCircle2Names.montariaArcana]: {
    spellCircle: spellsCircles.c2,
    nome: 'Montaria Arcana',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Conv',
  },
  [spellsCircle2Names.saltoDimensional]: {
    spellCircle: spellsCircles.c2,
    nome: 'Salto Dimensional',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Conv',
  },
  [spellsCircle2Names.servosInvisiveis]: {
    spellCircle: spellsCircles.c2,
    nome: 'Servos Invisíveis',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Conv',
  },
  [spellsCircle2Names.desesperoEsmagador]: {
    spellCircle: spellsCircles.c2,
    nome: 'Desespero Esmagador',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Encan',
  },
  [spellsCircle2Names.marcaDaObediencia]: {
    spellCircle: spellsCircles.c2,
    nome: 'Marca da Obediência',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Encan',
  },
  [spellsCircle2Names.bolaDeFogo]: {
    spellCircle: spellsCircles.c2,
    nome: 'Bola de Fogo',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Evoc',
  },
  [spellsCircle2Names.flechaAcida]: {
    spellCircle: spellsCircles.c2,
    nome: 'Flecha Ácida',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Evoc',
  },
  [spellsCircle2Names.relampago]: {
    spellCircle: spellsCircles.c2,
    nome: 'Relâmpago',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Evoc',
  },
  [spellsCircle2Names.soproDasUivantes]: {
    spellCircle: spellsCircles.c2,
    nome: 'Sopro das Uivantes',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Evoc',
  },
  [spellsCircle2Names.aparenciaPerfeita]: {
    spellCircle: spellsCircles.c2,
    nome: 'Aparência Perfeita',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Ilusão',
  },
  [spellsCircle2Names.camuflagemIlusoria]: {
    spellCircle: spellsCircles.c2,
    nome: 'Camuflagem Ilusória',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Ilusão',
  },
  [spellsCircle2Names.esculpirSons]: {
    spellCircle: spellsCircles.c2,
    nome: 'Esculpir Sons',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Ilusão',
  },
  [spellsCircle2Names.invisibilidade]: {
    spellCircle: spellsCircles.c2,
    nome: 'Invisibilidade',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Ilusão',
  },
  [spellsCircle2Names.conjurarMortosVivos]: {
    spellCircle: spellsCircles.c2,
    nome: 'Conjurar Mortos-Vivos',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Necro',
  },
  [spellsCircle2Names.cranioVoadorDeVladislav]: {
    spellCircle: spellsCircles.c2,
    nome: 'Crânio Voador de Vladislav',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Necro',
  },
  [spellsCircle2Names.toqueVampirico]: {
    spellCircle: spellsCircles.c2,
    nome: 'Toque Vampírico',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Necro',
  },
  [spellsCircle2Names.alterarTamanho]: {
    spellCircle: spellsCircles.c2,
    nome: 'Alterar Tamanho',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Trans',
  },
  [spellsCircle2Names.metamorfose]: {
    spellCircle: spellsCircles.c2,
    nome: 'Metamorfose',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Trans',
  },
  [spellsCircle2Names.velocidade]: {
    spellCircle: spellsCircles.c2,
    nome: 'Velocidade',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Trans',
  },
  [spellsCircle2Names.circuloDaJustica]: {
    spellCircle: spellsCircles.c2,
    nome: 'Círculo da Justiça',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Abjur',
  },
  [spellsCircle2Names.dissiparMagia]: {
    spellCircle: spellsCircles.c2,
    nome: 'Dissipar Magia',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Abjur',
  },
  [spellsCircle2Names.vestimentaDaFe]: {
    spellCircle: spellsCircles.c2,
    nome: 'Vestimenta da Fé',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Abjur',
  },
  [spellsCircle2Names.condicao]: {
    spellCircle: spellsCircles.c2,
    nome: 'Condição',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Adiv',
  },
  [spellsCircle2Names.globoDaVerdadeDeGwen]: {
    spellCircle: spellsCircles.c2,
    nome: 'Globo da Verdade de Gwen',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Adiv',
  },
  [spellsCircle2Names.menteDivina]: {
    spellCircle: spellsCircles.c2,
    nome: 'Mente Divina',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Adiv',
  },
  [spellsCircle2Names.vozDivina]: {
    spellCircle: spellsCircles.c2,
    nome: 'Voz Divina',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Adiv',
  },
  [spellsCircle2Names.enxameDePestes]: {
    spellCircle: spellsCircles.c2,
    nome: 'Enxame de Pestes',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Conv',
  },
  [spellsCircle2Names.socoDeArsenal]: {
    spellCircle: spellsCircles.c2,
    nome: 'Soco de Arsenal',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Conv',
  },
  [spellsCircle2Names.aliadoAnimal]: {
    spellCircle: spellsCircles.c2,
    nome: 'Aliado Animal',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Encan',
  },
  [spellsCircle2Names.marcaDaObediencia]: {
    spellCircle: spellsCircles.c2,
    nome: 'Marca da Obediência',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Encan',
  },
  [spellsCircle2Names.oracao]: {
    spellCircle: spellsCircles.c2,
    nome: 'Oração',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Encan',
  },
  [spellsCircle2Names.controlarFogo]: {
    spellCircle: spellsCircles.c2,
    nome: 'Controlar Fogo',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Evoc',
  },
  [spellsCircle2Names.purificacao]: {
    spellCircle: spellsCircles.c2,
    nome: 'Purificação',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Evoc',
  },
  [spellsCircle2Names.raioSolar]: {
    spellCircle: spellsCircles.c2,
    nome: 'Raio Solar',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Evoc',
  },
  [spellsCircle2Names.tempestadaDivina]: {
    spellCircle: spellsCircles.c2,
    nome: 'Tempestade Divina',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Evoc',
  },
  [spellsCircle2Names.silencio]: {
    spellCircle: spellsCircles.c2,
    nome: 'Silêncio',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Ilusão',
  },
  [spellsCircle2Names.miasmaMefitico]: {
    spellCircle: spellsCircles.c2,
    nome: 'Miasma Mefítico',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Necro',
  },
  [spellsCircle2Names.rogarMaldicao]: {
    spellCircle: spellsCircles.c2,
    nome: 'Rogar Maldição',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Necro',
  },
  [spellsCircle2Names.controlarMadeira]: {
    spellCircle: spellsCircles.c2,
    nome: 'Controlar Madeira',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Trans',
  },
  [spellsCircle2Names.fisicoDivino]: {
    spellCircle: spellsCircles.c2,
    nome: 'Físico Divino',
    execucao: '',
    alcance: '',
    alvo: '',
    duracao: '',
    resistencia: '',
    school: 'Trans',
  },
};

function cheapenSpell(
  spells: Spell[],
  index: number,
  manaReduction = 1
): {
  spells: Spell[];
  stepValue?: string;
} {
  const spellsToChange = spells;
  const { manaReduction: actualManaReduction = 0 } = spells[index];

  if (actualManaReduction < manaReduction) {
    spellsToChange[index] = {
      ...spells[index],
      manaReduction,
    };

    return {
      spells: spellsToChange,
      stepValue: `Redução de mana -${manaReduction} (${spellsToChange[index].nome})`,
    };
  }

  return {
    spells,
  };
}

export function addOrCheapenSpell(
  sheet: CharacterSheet,
  spell: Spell,
  customKeyAttr?: Atributo
): {
  spells: Spell[];
  stepValue?: string;
} {
  const index = sheet.spells.findIndex(
    (sheetSpell) => spell.nome === sheetSpell.nome
  );

  const spellClone = cloneDeep(spell);

  const spellToAdd = customKeyAttr
    ? { ...spellClone, customKeyAttr }
    : spellClone;

  if (index < 0) {
    return {
      spells: [...sheet.spells, spellToAdd],
      stepValue: `Adicionou magia ${spellToAdd.nome}`,
    };
  }

  return cheapenSpell(sheet.spells, index);
}

function getRandomSpells(allowedSpells: Spell[], qtd: number) {
  return pickFromArray(allowedSpells, qtd);
}

export function addOrCheapenRandomSpells(
  sheet: CharacterSheet,
  substeps: SubStep[],
  allowedSpells: Spell[],
  stepName: string,
  customKeyAttr: Atributo,
  qtd = 2
): void {
  const sheetToChange = sheet;
  const randomSpells = getRandomSpells(allowedSpells, qtd);

  randomSpells.forEach((randomSpell) => {
    const { spells, stepValue } = addOrCheapenSpell(
      sheet,
      randomSpell,
      customKeyAttr
    );

    sheetToChange.spells = spells;

    if (stepValue) {
      substeps.push({
        name: stepName,
        value: stepValue,
      });
    }
  });
}
